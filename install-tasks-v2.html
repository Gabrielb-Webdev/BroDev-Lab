<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Instalador de Tareas - BroDev Lab</title>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, sans-serif;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            min-height: 100vh;
            padding: 2rem;
            display: flex;
            align-items: center;
            justify-content: center;
        }

        .container {
            max-width: 800px;
            width: 100%;
            background: white;
            border-radius: 16px;
            box-shadow: 0 20px 60px rgba(0,0,0,0.3);
            overflow: hidden;
        }

        .header {
            background: linear-gradient(135deg, #7c3aed, #ec4899);
            color: white;
            padding: 2rem;
            text-align: center;
        }

        .header h1 {
            font-size: 1.75rem;
            margin-bottom: 0.5rem;
        }

        .content {
            padding: 2rem;
        }

        .warning {
            background: #fef3c7;
            border-left: 4px solid #f59e0b;
            padding: 1rem;
            border-radius: 4px;
            margin-bottom: 1.5rem;
        }

        .warning strong {
            color: #d97706;
            display: block;
            margin-bottom: 0.5rem;
        }

        .btn {
            background: linear-gradient(135deg, #7c3aed, #ec4899);
            color: white;
            border: none;
            padding: 1rem 2rem;
            font-size: 1.1rem;
            font-weight: 600;
            border-radius: 8px;
            cursor: pointer;
            width: 100%;
            transition: all 0.3s;
        }

        .btn:hover:not(:disabled) {
            transform: translateY(-2px);
            box-shadow: 0 8px 20px rgba(124, 58, 237, 0.4);
        }

        .btn:disabled {
            opacity: 0.6;
            cursor: not-allowed;
        }

        .progress {
            margin-top: 1.5rem;
            display: none;
        }

        .progress.show {
            display: block;
        }

        .progress-bar {
            height: 6px;
            background: #e5e7eb;
            border-radius: 3px;
            overflow: hidden;
            margin-bottom: 1rem;
        }

        .progress-fill {
            height: 100%;
            background: linear-gradient(90deg, #7c3aed, #ec4899);
            width: 0%;
            transition: width 0.3s;
        }

        .log {
            background: #1f2937;
            border-radius: 8px;
            padding: 1rem;
            max-height: 400px;
            overflow-y: auto;
            font-family: 'Courier New', monospace;
            font-size: 0.9rem;
        }

        .log-line {
            padding: 0.25rem 0;
            color: #9ca3af;
        }

        .log-success {
            color: #10b981;
        }

        .log-error {
            color: #ef4444;
        }

        .log-warning {
            color: #f59e0b;
        }

        .log-info {
            color: #60a5fa;
        }

        .summary {
            margin-top: 1.5rem;
            padding: 1rem;
            background: #f9fafb;
            border-radius: 8px;
            display: none;
        }

        .summary.show {
            display: block;
        }

        .summary h3 {
            color: #1f2937;
            margin-bottom: 0.5rem;
        }

        .summary-item {
            display: flex;
            justify-content: space-between;
            padding: 0.5rem 0;
            border-bottom: 1px solid #e5e7eb;
        }

        .summary-item:last-child {
            border-bottom: none;
        }

        .features {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
            gap: 1rem;
            margin: 1.5rem 0;
        }

        .feature {
            padding: 1rem;
            background: #f9fafb;
            border-radius: 8px;
            text-align: center;
        }

        .feature-icon {
            font-size: 2rem;
            margin-bottom: 0.5rem;
        }

        .feature-title {
            font-weight: 600;
            color: #1f2937;
            margin-bottom: 0.25rem;
        }

        .feature-desc {
            font-size: 0.875rem;
            color: #6b7280;
        }
    </style>
</head>
<body>
    <div class="container">
        <div class="header">
            <h1>ğŸ“‹ Instalador del Sistema de Tareas v0.2</h1>
            <p>BroDev Lab - Board/Kanban View</p>
        </div>

        <div class="content">
            <div class="features">
                <div class="feature">
                    <div class="feature-icon">ğŸ“</div>
                    <div class="feature-title">Tabla Tasks</div>
                    <div class="feature-desc">Tareas con estados y prioridades</div>
                </div>
                <div class="feature">
                    <div class="feature-icon">ğŸ’¬</div>
                    <div class="feature-title">Comentarios</div>
                    <div class="feature-desc">Sistema de comentarios por tarea</div>
                </div>
                <div class="feature">
                    <div class="feature-icon">ğŸ“Š</div>
                    <div class="feature-title">Subtareas</div>
                    <div class="feature-desc">JerarquÃ­a y organizaciÃ³n</div>
                </div>
                <div class="feature">
                    <div class="feature-icon">ğŸ“ˆ</div>
                    <div class="feature-title">Actividad</div>
                    <div class="feature-desc">Audit trail completo</div>
                </div>
                <div class="feature">
                    <div class="feature-icon">ğŸ·ï¸</div>
                    <div class="feature-title">Etiquetas</div>
                    <div class="feature-desc">Tags personalizables</div>
                </div>
                <div class="feature">
                    <div class="feature-icon">ğŸ“Œ</div>
                    <div class="feature-title">Datos Demo</div>
                    <div class="feature-desc">8 tareas de ejemplo</div>
                </div>
            </div>

            <div class="warning">
                <strong>âš ï¸ Antes de instalar:</strong>
                Este script crearÃ¡ TODAS las tablas necesarias (clients, admins, projects, tasks, etc.) en el orden correcto. Si ya existen algunas tablas, serÃ¡n omitidas automÃ¡ticamente. AsegÃºrate de tener un backup de tu base de datos.
            </div>

            <button class="btn" id="installBtn" onclick="installDatabase()">
                ğŸš€ Instalar Sistema de Tareas
            </button>

            <div class="progress" id="progress">
                <div class="progress-bar">
                    <div class="progress-fill" id="progressFill"></div>
                </div>
                <div class="log" id="log"></div>
            </div>

            <div class="summary" id="summary">
                <h3>ğŸ“Š Resumen de InstalaciÃ³n</h3>
                <div id="summaryContent"></div>
            </div>
        </div>
    </div>

    <script>
        async function installDatabase() {
            const btn = document.getElementById('installBtn');
            const progress = document.getElementById('progress');
            const progressFill = document.getElementById('progressFill');
            const log = document.getElementById('log');
            const summary = document.getElementById('summary');
            const summaryContent = document.getElementById('summaryContent');

            btn.disabled = true;
            btn.textContent = 'â³ Instalando...';
            progress.classList.add('show');
            log.innerHTML = '';

            function addLog(message, type = 'info') {
                const line = document.createElement('div');
                line.className = `log-line log-${type}`;
                const time = new Date().toLocaleTimeString();
                line.textContent = `[${time}] ${message}`;
                log.appendChild(line);
                log.scrollTop = log.scrollHeight;
            }

            try {
                addLog('ğŸ“¦ Iniciando instalaciÃ³n...', 'info');
                progressFill.style.width = '10%';

                addLog('ğŸ”— Conectando con el servidor...', 'info');
                progressFill.style.width = '20%';

                const response = await fetch('/install-tasks-batch.php', {
                    method: 'POST',
                    headers: { 'Content-Type': 'application/json' }
                });

                if (!response.ok) {
                    throw new Error(`Error HTTP: ${response.status}`);
                }

                const data = await response.json();
                progressFill.style.width = '50%';

                if (!data.success) {
                    throw new Error(data.error || 'Error desconocido');
                }

                addLog('âœ… Respuesta recibida', 'success');
                progressFill.style.width = '60%';

                // Mostrar resultados
                let errors = 0;
                data.results.forEach((result, index) => {
                    const progress = 60 + (index / data.results.length) * 35;
                    progressFill.style.width = `${progress}%`;

                    if (result.success) {
                        if (result.warning) {
                            addLog(`âš ï¸ ${result.message}`, 'warning');
                        } else {
                            addLog(`âœ… ${result.message}`, 'success');
                        }
                    } else {
                        addLog(`âŒ ${result.message}`, 'error');
                        errors++;
                    }
                });

                progressFill.style.width = '100%';

                // Mostrar resumen
                if (errors === 0) {
                    addLog('', 'success');
                    addLog('â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”', 'success');
                    addLog('ğŸ‰ Â¡InstalaciÃ³n Completada con Ã‰xito!', 'success');
                    addLog('â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”', 'success');
                    addLog('', 'success');
                    addLog('âœ… Tablas creadas: tasks, task_comments, task_activity, subtasks, task_tags', 'success');
                    addLog('âœ… 8 tareas de ejemplo insertadas', 'success');
                    addLog('', 'info');
                    addLog('ğŸš€ PrÃ³ximo paso:', 'info');
                    addLog('   Abre: https://grey-squirrel-133805.hostingersite.com/admin/board-view.html', 'info');

                    btn.textContent = 'âœ… InstalaciÃ³n Exitosa';
                    btn.style.background = '#10b981';
                } else {
                    addLog('', 'warning');
                    addLog(`âš ï¸ Completado con ${errors} errores`, 'warning');
                    btn.textContent = `âš ï¸ Completado con ${errors} errores`;
                    btn.style.background = '#f59e0b';
                }

                // Mostrar resumen
                summary.classList.add('show');
                summaryContent.innerHTML = `
                    <div class="summary-item">
                        <span>Total operaciones:</span>
                        <strong>${data.summary.total}</strong>
                    </div>
                    <div class="summary-item">
                        <span>Exitosas:</span>
                        <strong style="color: #10b981;">${data.summary.success}</strong>
                    </div>
                    <div class="summary-item">
                        <span>Errores:</span>
                        <strong style="color: #ef4444;">${data.summary.errors}</strong>
                    </div>
                `;

            } catch (error) {
                addLog('', 'error');
                addLog(`âŒ Error Fatal: ${error.message}`, 'error');
                addLog('', 'error');
                addLog('ğŸ’¡ Sugerencias:', 'info');
                addLog('   1. Verifica que los archivos SQL existen', 'info');
                addLog('   2. Revisa config/config.php con credenciales correctas', 'info');
                addLog('   3. AsegÃºrate de que el proyecto estÃ¡ conectado a la BD', 'info');
                
                btn.textContent = 'âŒ Error en InstalaciÃ³n';
                btn.style.background = '#ef4444';
                btn.disabled = false;
            }
        }
    </script>
</body>
</html>
